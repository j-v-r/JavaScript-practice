<html><div id="a"><div id="b"></div></div>
<script>
function appendChildren(decorateDivFunction) {
  var allDivs = document.getElementsByTagName("div");
  var newDiv = document.createElement("div");
  decorateDivFunction(newDiv);
  for (var i = (allDivs.length -1); i >= 0 ; i--) {  
  	if(allDivs[i].hasChildNodes()) {
  		var childNode = allDivs[i].innerHTML;
  		var newNode = allDivs[i].cloneNode();
  		newNode.innerHTML += childNode;
  		newNode.appendChild(newDiv);
  		console.log(newNode);
  		document.body.innerHTML = "";
  		document.body.appendChild(newNode);
  	} else {
  		allDivs[i].appendChild(newDiv);
  	}
 
    
  }
}

appendChildren();
</script>
</html>